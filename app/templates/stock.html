<!-- https://www.amcharts.com/kbase/stock-chart-google-finance-csv-api/-->

{% extends "base.html" %}

{% block navbar %}

{% include "navigation.html" %}

{%endblock%}
{% block body %}









<style>
#chartdiv {
  width: 100%;
  height: 100%;
}
</style>

<script src="//www.amcharts.com/lib/3/amcharts.js"></script>
<script src="//www.amcharts.com/lib/3/serial.js"></script>
<script src="//www.amcharts.com/lib/3/themes/light.js"></script>
<script src="//www.amcharts.com/lib/3/amstock.js"></script>
<script src="//www.amcharts.com/lib/3/plugins/dataloader/dataloader.min.js"></script>
<div id="chartdiv"></div>
<script>
var chart = AmCharts.makeChart( "chartdiv", {
"type": "stock",
"theme": "light",

"dataDateFormat": "DD-MM-YYYY",

"dataSets": [ {
  "title": "MSFT",
  "fieldMappings": [ {
    "fromField": "Close",
    "toField": "value"
  }, {
    "fromField": "Volume",
    "toField": "volume"
  } ],
  "dataLoader": {

    /**
     * Originally we assume URL:
     * https://finance.google.co.uk/finance/historical?q=MSFT&startdate=Oct+1,2008&enddate=Oct+9,2008&output=csv
     * However, due to CORS restrictions, we are using the copy of the out
     */
    "url": "https://s3-us-west-2.amazonaws.com/s.cdpn.io/t-160/google_msft.csv",
    "format": "csv",
    "delimiter": ",",
    "useColumnNames": true,
    "skip": 1,
    "numberFields": ["Close", "Volume"],
    "reverse": true,

    /**
     * Google Finance API returns dates formatted like this "24-Apr-17".
     * The chart can't parse month names as well as two-digit years, so we
     * need to use `postProcess` callback to reformat those dates into a
     * chart-readable format
     */
    "postProcess": function( data ) {

      // Function that reformats dates
      function reformatDate( input ) {

        // Reformat months
        var mapObj = {
          "Jan": "01",
          "Feb": "02",
          "Mar": "03",
          "Apr": "04",
          "May": "05",
          "Jun": "06",
          "Jul": "07",
          "Aug": "08",
          "Sep": "09",
          "Oct": "10",
          "Nov": "11",
          "Dec": "12"
        };

        var re = new RegExp( Object.keys( mapObj ).join( "|" ), "gi" );
        input = input.replace( re, function( matched ) {
          return mapObj[ matched ];
        } );

        // Reformat years and days into four and two digits respectively
        var p = input.split("-");
        if (p[0].length == 1) {
          p[0] = "0" + p[0];
        }
        if (Number(p[2]) > 50) {
          p[2] = "19" + p[2];
        }
        else {
          p[2] = "20" + p[2];
        }
        return p.join("-");
      }

      // Reformat all dates
      for ( var i = 0; i < data.length; i++ ) {
        data[ i ].Date = reformatDate( data[ i ].Date );
      }

      console.log(data);

      return data;
    }
  },
  "categoryField": "Date"
} ],

"panels": [ {
    "showCategoryAxis": false,
    "title": "Value",
    "percentHeight": 70,

    "stockGraphs": [ {
      id: "g1",
      valueField: "value",
      comparable: true,
      compareField: "value",
      balloonText: "[[title]]:<b>[[value]]</b>",
      compareGraphBalloonText: "[[title]]:<b>[[value]]</b>"
    } ],

    stockLegend: {
      periodValueTextComparing: "[[percents.value.close]]%",
      periodValueTextRegular: "[[value.close]]"
    }
  },

  {
    "title": "Volume",
    "percentHeight": 30,
    "stockGraphs": [ {
      valueField: "volume",
      type: "column",
      showBalloon: false,
      fillAlphas: 1
    } ],

    stockLegend: {
      periodValueTextRegular: "[[value.close]]"
    }
  }
],

"chartScrollbarSettings": {
  "graph": "g1"
},

"chartCursorSettings": {
  "valueBalloonsEnabled": true,
  "fullWidth": true,
  "cursorAlpha": 0.1,
  "valueLineBalloonEnabled": true,
  "valueLineEnabled": true,
  "valueLineAlpha": 0.5
},

periodSelector: {
  periods: [ {
    period: "MM",
    selected: true,
    count: 1,
    label: "1 month"
  }, {
    period: "YYYY",
    count: 1,
    label: "1 year"
  }, {
    period: "YTD",
    label: "YTD"
  }, {
    period: "MAX",
    label: "MAX"
  } ]
}
} );


</script>
{% endblock %}
